<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.school.mapper.BlogCommentMapper">
    <resultMap id="BlogCommentResultMap" type="com.school.entity.BlogComment">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="blogId" column="blog_id"/>
        <result property="parentId" column="parent_id"/>
        <result property="answerId" column="answer_id"/>
        <result property="content" column="content" />
        <result property="liked" column="liked" />
        <result property="images" column="images" />
        <result property="createTime" column="create_time" />
    </resultMap>
    <insert id="insertComment" parameterType="com.school.entity.BlogComment" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO blog_comments (user_id, blog_id, parent_id, answer_id, content, images, create_time)
        VALUES (#{userId}, #{blogId}, #{parentId}, #{answerId}, #{content}, #{images}, #{createTime})
    </insert>
    <delete id="deleteComment" parameterType="Long">
        DELETE FROM blog_comments WHERE id = #{id} or parent_id = #{id}
    </delete>
    <select id="selectCommentById" parameterType="Long" resultMap="BlogCommentResultMap">
        SELECT * FROM blog_comments WHERE id = #{id}
    </select>
    <select id="selectParentCommentByBlogId" parameterType="Long" resultMap="BlogCommentResultMap">
        SELECT * FROM blog_comments WHERE blog_id = #{blogId} and parent_id = 0
        ORDER BY liked DESC, id DESC;
    </select>
    <select id="selectSonCommentByBlogId" parameterType="Long" resultMap="BlogCommentResultMap">
        SELECT * FROM blog_comments WHERE parent_id = #{parentId} and blog_id = #{blogId}
        ORDER BY liked DESC, id DESC;
    </select>
    <select id="selectCommentByBlogIdAndId" parameterType="Long" resultMap="BlogCommentResultMap">
        SELECT * FROM blog_comments WHERE blog_id = #{blogId} and id = #{id}
    </select>
    <update id="likeComment" parameterType="Long">
        UPDATE blog_comments SET liked = liked + 1 WHERE id = #{id}
    </update>
    <update id="unLikeComment" parameterType="Long">
        UPDATE blog_comments SET liked = liked - 1 WHERE id = #{id}
    </update>

</mapper>
